{
  "active": false,
  "connections": {
    "子流程入口": {
      "main": [
        [
          {
            "node": "机器人关键词处理",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "钉钉机器人-text",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "钉钉机器人-markdown",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "钉钉机器人-text": {
      "main": [
        []
      ]
    },
    "机器人关键词处理": {
      "main": [
        [
          {
            "node": "判断sessionWebhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "判断sessionWebhook": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "钉钉webhook",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-06-27T04:05:59.471Z",
  "id": "4tHTAEVO9ryUxOhn",
  "isArchived": false,
  "meta": {
    "templateCredsSetupCompleted": true
  },
  "name": "sub-钉钉通知",
  "nodes": [
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "  {\n    \"msgtype\": \"text\",\n    \"sessionWebhook\":\"robot/sendBySession\",\n    \"content\": \"content\",\n    \"title\": \"title\",\n    \"name\": \"名称\",\n    \"state\": \"成功\"\n  }"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -416,
        128
      ],
      "id": "de4e7850-1148-4e14-9f43-9c36a39676f4",
      "name": "子流程入口",
      "notesInFlow": false
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.msgtype }}",
                    "rightValue": "text",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "cccd874a-f90c-459a-986c-e0eb7b7c0e72"
                  }
                ],
                "combinator": "and"
              }
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8c3c18ff-32d9-4ddf-87b0-4e29cf5b5fe5",
                    "leftValue": "={{ $json.msgtype }}",
                    "rightValue": "markdown",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        256,
        32
      ],
      "id": "271e64cd-5b22-4a74-ac8d-dffc9f69fc08",
      "name": "Switch"
    },
    {
      "parameters": {
        "msgtype": "markdown",
        "title": "={{ $json.title }}",
        "markdownText": "={{ $json.content }}"
      },
      "type": "n8n-nodes-dingtalk.dingTalkRobot",
      "typeVersion": 1,
      "position": [
        480,
        128
      ],
      "id": "9b298538-2d9a-495e-ac61-0bf649edd318",
      "name": "钉钉机器人-markdown",
      "credentials": {
        "dingTalkCustomRobotApi": {
          "id": "ewEy0mraYFqwnuN2",
          "name": "DingTalk - Automation"
        }
      }
    },
    {
      "parameters": {
        "content": "={{ $json.content }}"
      },
      "type": "n8n-nodes-dingtalk.dingTalkRobot",
      "typeVersion": 1,
      "position": [
        480,
        -64
      ],
      "id": "052364b9-7d67-4be4-b4b7-00f81619fc14",
      "name": "钉钉机器人-text",
      "credentials": {
        "dingTalkCustomRobotApi": {
          "id": "ewEy0mraYFqwnuN2",
          "name": "DingTalk - Automation"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "return $input.all().map(item => {\n  const data = item.json;\n  // type\n  const msgtypeMap = { md: 'markdown' };\n  data.msgtype = msgtypeMap[data.msgtype] || data.msgtype;\n\n  // 名称\n  let name = data.name || $workflow.name.replaceAll('sub-','');\n  // 状态\n  let state = data.state || '💬';\n  switch (state) {\n    case '失败':\n    case '错误':\n      state = state+'❌';\n      break;\n    case '成功':\n    case '完成':\n      state = state+'✅';\n      break;\n  }\n  \n  // 消息头\n  const msgHeader  = `${name}: ${state} - n8n Automation Notify\\n\\n`  \n  \n  if (!data.sessionWebhook) {\n    // 内容 \n    data.content = msgHeader + data.content;\n  }\n  data.title = data.title || '';\n  return { json: data };\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        128
      ],
      "id": "a0dee420-3206-4cf1-80cb-0aecb48c86d9",
      "name": "机器人关键词处理"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "={{ $json.sessionWebhook }}",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={\n  \"msgtype\": \"{{$json.msgtype}}\",\n  \"text\": {\n        \"content\": {{$json.content.toJsonString()}}\n  },\n  \"markdown\": {\n         \"title\": \"{{$json.title}}\",\n         \"text\": {{$json.content.toJsonString()}}\n  }\n}",
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        256,
        224
      ],
      "id": "7faa5e3a-355c-4310-8b2f-a5806a155aa2",
      "name": "钉钉webhook",
      "retryOnFail": true,
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "mode": "expression",
        "numberOutputs": 2,
        "output": "={{ !$json.sessionWebhook ? 0:1 }}"
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        32,
        128
      ],
      "id": "ca5e62f4-db75-4c65-bf90-4a97fd6044bc",
      "name": "判断sessionWebhook"
    }
  ],
  "pinData": {
    "子流程入口": [
      {
        "json": {
          "msgtype": "text",
          "sessionWebhook": "https://oapi.dingtalk.com/robot/sendBySession?session=efefbd8815ee1205506d5f50910c2b3c",
          "content": "嗯，你说到“国际化”，是想了解什么呢？\n\n*   你是想问我是否支持多种语言吗？\n*   还是想讨论关于国际化的话题？\n*   或者有什么具体的问题需要我帮忙解答？\n\n请告诉我更多细节，我才能更好地帮助你哦！😊",
          "title": null,
          "name": null,
          "state": null
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1",
    "timezone": "Asia/Shanghai",
    "callerPolicy": "workflowsFromSameOwner"
  },
  "shared": [
    {
      "createdAt": "2025-06-27T04:05:59.496Z",
      "updatedAt": "2025-06-27T04:05:59.496Z",
      "role": "workflow:owner",
      "workflowId": "4tHTAEVO9ryUxOhn",
      "projectId": "BeX3bor8ts20lbDK"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-07-11T02:54:27.831Z",
      "updatedAt": "2025-07-11T03:55:43.484Z",
      "id": "JqrpOsXNCY5fMnlD",
      "name": "Common"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-09-12T06:09:37.000Z",
  "versionId": "214d64ef-5ede-4abd-99f3-d3de74a3986d"
}