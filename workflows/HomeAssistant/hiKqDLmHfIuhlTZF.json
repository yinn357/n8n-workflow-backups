{
  "active": false,
  "connections": {
    "HA获取变量记录": {
      "main": [
        [
          {
            "node": "获取记录",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "获取记录": {
      "main": [
        [
          {
            "node": "toMarkdown内容",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "createdAt": "2025-09-10T02:40:31.554Z",
  "id": "hiKqDLmHfIuhlTZF",
  "isArchived": false,
  "meta": null,
  "name": "sub-获取变量记录",
  "nodes": [
    {
      "parameters": {
        "workflowInputs": {
          "values": [
            {
              "name": "size",
              "type": "number"
            }
          ]
        }
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -256,
        -80
      ],
      "id": "8739b0a6-dd4f-465c-a683-8a1bdfd8cbf7",
      "name": "HA获取变量记录"
    },
    {
      "parameters": {
        "jsCode": "// 反转数组\n$input.all().reverse()\n/**\n * 将数据数组转换成 Markdown Table 格式\n */\nfunction toMarkdownTable(jsonArray, ignoreFields = []) {\n  const headers = Object.keys(jsonArray[0].json).filter(h => !ignoreFields.includes(h));\n  const headerRow = '| ' + headers.join(' | ') + ' |';\n  const separatorRow = '| ' + headers.map(() => '---').join(' | ') + ' |';\n\n  const dataRows = jsonArray.map(obj =>\n    '| ' + headers.map(h => String(obj.json[h]).replace(/\\|/g, '\\\\|')).join(' | ') + ' |'\n  );\n\n  return [headerRow, separatorRow, ...dataRows].join('\\n');\n}\nconst ignoreFields = ['源数据', '_id', 'id', 'keys'];\nlet tableMd = toMarkdownTable($input.all(), ignoreFields);\n\n/**\n * 将数据数组转换成 Markdown 形式：\n * ### HH:MM\n * - 人: x    灯: y    器: z\n */\nfunction toSimpleMd(data) {\n  return data.map(item => {\n    const json = item.json\n    // 截取时间中的时:分\n    const hhmm = json['时间']?.slice(11, 16);\n    const people = json['有人'];\n    const lamps  = json['灯光数量'];\n    const devices= json['家电数量'];\n    const light= json['光照度'].toFixed(2);\n    const lightAvg= json['平均光照度'];\n    // return `### ${hhmm}\\n- 人: ${people}\\t灯: ${lamps}\\t器: ${devices}`;\n    return `- 🕦${hhmm} 🧍‍${people} 💡${lamps} 🔌${devices} 🔆‍${lightAvg}/‍${light}`;  \n    \n  }).join('\\n');\n}\n\nlet listMd = toSimpleMd($input.all());\nreturn [{\n  json:{tableMd,listMd}\n}]"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        192,
        -80
      ],
      "id": "a38ccc0b-f92d-4d35-bf2a-23b163ebb8d3",
      "name": "toMarkdown内容"
    },
    {
      "parameters": {
        "db_path": "/files/database/home-assistant.db",
        "query_type": "SELECT",
        "query": "=SELECT * FROM global_variables order by `时间` desc limit {{ $json.size }}",
        "spread": true
      },
      "type": "n8n-nodes-sqlite3.sqliteNode",
      "typeVersion": 1,
      "position": [
        -16,
        -80
      ],
      "id": "ddeaddc8-f70a-4510-a66f-7cb883bd5574",
      "name": "获取记录"
    }
  ],
  "pinData": {
    "HA获取变量记录": [
      {
        "json": {
          "size": 3
        }
      }
    ]
  },
  "settings": {
    "executionOrder": "v1"
  },
  "shared": [
    {
      "createdAt": "2025-09-10T02:40:31.574Z",
      "updatedAt": "2025-09-10T02:40:31.574Z",
      "role": "workflow:owner",
      "workflowId": "hiKqDLmHfIuhlTZF",
      "projectId": "BeX3bor8ts20lbDK"
    }
  ],
  "staticData": null,
  "tags": [
    {
      "createdAt": "2025-06-26T06:14:33.448Z",
      "updatedAt": "2025-09-10T02:08:30.393Z",
      "id": "FHV017iDd8qf8jAL",
      "name": "HomeAssistant"
    },
    {
      "createdAt": "2025-07-11T02:54:27.831Z",
      "updatedAt": "2025-07-11T03:55:43.484Z",
      "id": "JqrpOsXNCY5fMnlD",
      "name": "Common"
    }
  ],
  "triggerCount": 0,
  "updatedAt": "2025-09-10T06:16:25.000Z",
  "versionId": "2f28ba3d-eabe-47a5-96fe-91dbdc75a770"
}